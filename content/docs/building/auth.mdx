---
title: "Authentication"
---

# Authentication

Ghoststack has magic link authentication via Supabase built in — login page, callback handling, session management, and protected routes.

Your job: create a Supabase project and add your keys. The auth code is ready.

## Step 1: Create Supabase Project

1. Go to [supabase.com](https://supabase.com) → Sign up
2. Click **New Project** → Choose name and password
3. Wait ~2 minutes for setup

## Step 2: Create Environment File

If you haven't done so yet, create your local environment file from the example:

```bash
cp -n .env.example .env.local
```

This creates `.env.local` with all the required variable names ready to fill in. (If the file already exists, nothing happens.)

## Step 3: Get Keys

Get your keys from the Supabase Dashboard and add them to `.env.local`:

| Key | Where to find it |
|-----|------------------|
| `NEXT_PUBLIC_SUPABASE_URL` | [Project Settings](https://supabase.com/dashboard/project/_) → Copy Project URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | [API Keys](https://supabase.com/dashboard/project/_/settings/api-keys/legacy) → Copy anon public key |
| `SUPABASE_SERVICE_ROLE_KEY` | [API Keys](https://supabase.com/dashboard/project/_/settings/api-keys/legacy) → Copy service_role secret |

```bash
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

> **Tip:** New to .env files? See [Environment Variables](/docs/concepts/env-files).
>
> **Warning:** Never paste secret keys into AI prompts. Add them to `.env.local` yourself.

## Step 4: Set Up Supabase MCP

MCP (Model Context Protocol) lets your AI tool interact directly with Supabase — creating tables, running queries, and more.

### Cursor

1. Go to [supabase.com/docs/guides/getting-started/mcp](https://supabase.com/docs/guides/getting-started/mcp)
2. Click **Add to Cursor**
3. Authorize access in the browser when prompted

### Claude Code

Run in your terminal:

```bash
claude mcp add --transport http supabase https://mcp.supabase.com/mcp
```

Then run `/mcp` inside Claude Code to authenticate.

> **More details:** See [MCP Servers](/docs/concepts/mcps) for full setup instructions. 

## Step 5: Configure Redirect URLs

In Supabase Dashboard → **Authentication** → **URL Configuration**:

| Setting | Value |
|---------|-------|
| Site URL | `http://localhost:3000` |
| Redirect URLs | `http://localhost:3000/**` |

## Step 6: Set Up Database

```
Use the Supabase MCP to run the full database setup.

Run supabase/setup.sql to create:
- users table with RLS
- subscriptions table with RLS
- Trigger to auto-create user profile on signup

Follow @AGENTS.md patterns.
```

---

## Prompt Examples

These prompts are independent — use whichever ones you need or create your own.

### Check Auth Setup

```
The boilerplate already has auth code. Please verify my setup:

1. Check the code references the correct env var names (NEXT_PUBLIC_SUPABASE_URL, etc.)
2. Verify Supabase MCP is available (check via /mcp or verify config)
3. Trace the auth flow: login page → callback → dashboard redirect

Fix any code issues you find. I'll verify my .env.local values myself.

Follow @AGENTS.md patterns.
```

### Customize Login Page

```
Customize the existing login page at app/login/page.tsx.

App name: [YOUR APP NAME]
Purpose: [WHAT IT DOES]

Update the headline and description. Keep the auth logic intact.
Use DaisyUI only. @web https://daisyui.com/llms.txt
```

### Require Login for a Page

Want a page that only logged-in users can see? Add it to the `protectedRoutes` list in `proxy.ts`. Visitors who aren't logged in get redirected to the login page automatically.

```
I want the [ROUTE] page to require login. 
If someone isn't logged in, redirect them to the login page.

Add it to the protectedRoutes array in proxy.ts.
Follow @AGENTS.md patterns.
```

## Testing

1. Go to `/login` → enter email → check inbox → click link
2. Should land on `/dashboard`
3. Close browser → reopen → still logged in
4. Visit `/dashboard` logged out → redirects to `/login`

## What's Next

- [Payments](/docs/building/payments) — Add Stripe subscriptions
